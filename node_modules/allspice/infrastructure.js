var futureExports = {};

var path = require('path');
function getRequire(dirname) {
  return function (mod) {
    if (/\//.test(mod)) {
      var desired = stripJsExt(path.resolve(dirname, mod)),
        isLocal = combinedModules.some(function (combined) {
          return stripJsExt(combined) === desired;
        });

      if (isLocal) {
        var moduleName = getModule(desired);
        if (futureExports[moduleName]) {
          loadModule(moduleName);
        }
        var module =  exports[getModule(desired)];
        if (module) {
          return module;
        }
      }
    }
    require(mod);
  }
}

function getModule(filepath) {
  var file = path.basename(filepath);
  return stripJsExt(file);
}

function stripJsExt(filepath) {
  return filepath.replace(/\.js$/, '');
}

function loadModules() {
  Object.keys(futureExports).forEach(loadModule);
}

function loadModule(mod) {
  exports[mod] = futureExports[mod]();
  delete futureExports[mod];
}
